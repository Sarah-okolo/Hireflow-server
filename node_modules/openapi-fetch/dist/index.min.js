var G=/\{[^{}]+\}/g,M=()=>typeof process=="object"&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici;function Q(){return Math.random().toString(36).slice(2,11)}function k(n){let{baseUrl:e="",Request:t=globalThis.Request,fetch:o=globalThis.fetch,querySerializer:r,bodySerializer:i,headers:c,requestInitExt:u=void 0,...v}={...n};u=M()?u:void 0,e=P(e);let h=[];async function p(l,s){let{baseUrl:m,fetch:U=o,Request:Y=t,headers:B,params:w={},parseAs:A="json",querySerializer:E,bodySerializer:D=i??K,body:H,...S}=s||{};m&&(e=P(m));let $=typeof r=="function"?r:I(r);E&&($=typeof E=="function"?E:I({...typeof r=="object"?r:{},...E}));let O=H===void 0?void 0:D(H),W=O===void 0||O instanceof FormData?{}:{"Content-Type":"application/json"},F={redirect:"follow",...v,...S,body:O,headers:X(W,c,B,w.header)},j,T,y=new t(V(l,{baseUrl:e,params:w,querySerializer:$}),F),f;for(let d in S)d in y||(y[d]=S[d]);if(h.length){j=Q(),T=Object.freeze({baseUrl:e,fetch:U,parseAs:A,querySerializer:$,bodySerializer:D});for(let d of h)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){let a=await d.onRequest({request:y,schemaPath:l,params:w,options:T,id:j});if(a)if(a instanceof t)y=a;else if(a instanceof Response){f=a;break}else throw new Error("onRequest: must return new Request() or Response() when modifying the request")}}if(!f){try{f=await U(y,u)}catch(d){let a=d;if(h.length)for(let b=h.length-1;b>=0;b--){let x=h[b];if(x&&typeof x=="object"&&typeof x.onError=="function"){let R=await x.onError({request:y,error:a,schemaPath:l,params:w,options:T,id:j});if(R){if(R instanceof Response){a=void 0,f=R;break}if(R instanceof Error){a=R;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(a)throw a}if(h.length)for(let d=h.length-1;d>=0;d--){let a=h[d];if(a&&typeof a=="object"&&typeof a.onResponse=="function"){let b=await a.onResponse({request:y,response:f,schemaPath:l,params:w,options:T,id:j});if(b){if(!(b instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");f=b}}}}if(f.status===204||y.method==="HEAD"||f.headers.get("Content-Length")==="0")return f.ok?{data:void 0,response:f}:{error:void 0,response:f};if(f.ok)return A==="stream"?{data:f.body,response:f}:{data:await f[A](),response:f};let q=await f.text();try{q=JSON.parse(q)}catch{}return{error:q,response:f}}return{request(l,s,m){return p(s,{...m,method:l.toUpperCase()})},GET(l,s){return p(l,{...s,method:"GET"})},PUT(l,s){return p(l,{...s,method:"PUT"})},POST(l,s){return p(l,{...s,method:"POST"})},DELETE(l,s){return p(l,{...s,method:"DELETE"})},OPTIONS(l,s){return p(l,{...s,method:"OPTIONS"})},HEAD(l,s){return p(l,{...s,method:"HEAD"})},PATCH(l,s){return p(l,{...s,method:"PATCH"})},TRACE(l,s){return p(l,{...s,method:"TRACE"})},use(...l){for(let s of l)if(s){if(typeof s!="object"||!("onRequest"in s||"onResponse"in s||"onError"in s))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");h.push(s)}},eject(...l){for(let s of l){let m=h.indexOf(s);m!==-1&&h.splice(m,1)}}}}var C=class{constructor(e,t){this.client=e,this.url=t}GET(e){return this.client.GET(this.url,e)}PUT(e){return this.client.PUT(this.url,e)}POST(e){return this.client.POST(this.url,e)}DELETE(e){return this.client.DELETE(this.url,e)}OPTIONS(e){return this.client.OPTIONS(this.url,e)}HEAD(e){return this.client.HEAD(this.url,e)}PATCH(e){return this.client.PATCH(this.url,e)}TRACE(e){return this.client.TRACE(this.url,e)}},z=class{constructor(){this.client=null}get(e,t){let o=new C(e,t);return this.client[t]=o,o}};function J(n){let e=new z,t=new Proxy(n,e);function o(){}o.prototype=t;let r=new o;return e.client=r,r}function Z(n){return J(k(n))}function g(n,e,t){if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${n}=${t?.allowReserved===!0?e:encodeURIComponent(e)}`}function L(n,e,t){if(!e||typeof e!="object")return"";let o=[],r={simple:",",label:".",matrix:";"}[t.style]||"&";if(t.style!=="deepObject"&&t.explode===!1){for(let u in e)o.push(u,t.allowReserved===!0?e[u]:encodeURIComponent(e[u]));let c=o.join(",");switch(t.style){case"form":return`${n}=${c}`;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return c}}for(let c in e){let u=t.style==="deepObject"?`${n}[${c}]`:c;o.push(g(u,e[c],t))}let i=o.join(r);return t.style==="label"||t.style==="matrix"?`${r}${i}`:i}function N(n,e,t){if(!Array.isArray(e))return"";if(t.explode===!1){let i={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[t.style]||",",c=(t.allowReserved===!0?e:e.map(u=>encodeURIComponent(u))).join(i);switch(t.style){case"simple":return c;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return`${n}=${c}`}}let o={simple:",",label:".",matrix:";"}[t.style]||"&",r=[];for(let i of e)t.style==="simple"||t.style==="label"?r.push(t.allowReserved===!0?i:encodeURIComponent(i)):r.push(g(n,i,t));return t.style==="label"||t.style==="matrix"?`${o}${r.join(o)}`:r.join(o)}function I(n){return function(t){let o=[];if(t&&typeof t=="object")for(let r in t){let i=t[r];if(i!=null){if(Array.isArray(i)){if(i.length===0)continue;o.push(N(r,i,{style:"form",explode:!0,...n?.array,allowReserved:n?.allowReserved||!1}));continue}if(typeof i=="object"){o.push(L(r,i,{style:"deepObject",explode:!0,...n?.object,allowReserved:n?.allowReserved||!1}));continue}o.push(g(r,i,n))}}return o.join("&")}}function _(n,e){let t=n;for(let o of n.match(G)??[]){let r=o.substring(1,o.length-1),i=!1,c="simple";if(r.endsWith("*")&&(i=!0,r=r.substring(0,r.length-1)),r.startsWith(".")?(c="label",r=r.substring(1)):r.startsWith(";")&&(c="matrix",r=r.substring(1)),!e||e[r]===void 0||e[r]===null)continue;let u=e[r];if(Array.isArray(u)){t=t.replace(o,N(r,u,{style:c,explode:i}));continue}if(typeof u=="object"){t=t.replace(o,L(r,u,{style:c,explode:i}));continue}if(c==="matrix"){t=t.replace(o,`;${g(r,u)}`);continue}t=t.replace(o,c==="label"?`.${encodeURIComponent(u)}`:encodeURIComponent(u))}return t}function K(n){return n instanceof FormData?n:JSON.stringify(n)}function V(n,e){let t=`${e.baseUrl}${n}`;e.params?.path&&(t=_(t,e.params.path));let o=e.querySerializer(e.params.query??{});return o.startsWith("?")&&(o=o.substring(1)),o&&(t+=`?${o}`),t}function X(...n){let e=new Headers;for(let t of n){if(!t||typeof t!="object")continue;let o=t instanceof Headers?t.entries():Object.entries(t);for(let[r,i]of o)if(i===null)e.delete(r);else if(Array.isArray(i))for(let c of i)e.append(r,c);else i!==void 0&&e.set(r,i)}return e}function P(n){return n.endsWith("/")?n.substring(0,n.length-1):n}export{V as createFinalURL,Z as createPathBasedClient,I as createQuerySerializer,k as default,K as defaultBodySerializer,_ as defaultPathSerializer,X as mergeHeaders,Q as randomID,P as removeTrailingSlash,N as serializeArrayParam,L as serializeObjectParam,g as serializePrimitiveParam,J as wrapAsPathBasedClient};
